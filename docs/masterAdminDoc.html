

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Admin Documentation &mdash; StuRa - Mitgliederdatenbank  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Developer Documentation" href="masterDeveloperDoc.html" />
    <link rel="prev" title="User Documentation" href="masterUserDoc.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> StuRa - Mitgliederdatenbank
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="masterUserDoc.html">User Documentation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Admin Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#deployment">Deployment</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#sources">Sources:</a></li>
<li class="toctree-l3"><a class="reference internal" href="#requirements">Requirements:</a></li>
<li class="toctree-l3"><a class="reference internal" href="#basic-configuration">Basic configuration:</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adjust-django-project-settings">Adjust Django Project Settings:</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configure-apache2">Configure Apache2:</a></li>
<li class="toctree-l3"><a class="reference internal" href="#solve-some-permission-issues">Solve some Permission Issues:</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#cronjobs">Cronjobs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#update-the-application">Update the Application</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#update-from-github-with-no-changes-in-migrations">Update From GitHub with no changes in migrations:</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="masterDeveloperDoc.html">Developer Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="masterCodeDoc.html">Code Documentation</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">StuRa - Mitgliederdatenbank</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Admin Documentation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/masterAdminDoc.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="admin-documentation">
<h1>Admin Documentation<a class="headerlink" href="#admin-documentation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="deployment">
<h2>Deployment<a class="headerlink" href="#deployment" title="Permalink to this headline">¶</a></h2>
<p>This section contains a step-by-step guidance how to deploy this software.
It`s based on a deployment of Django with Apache2 and mod_wsgi on a raspberry pi 4.</p>
<div class="section" id="sources">
<h3>Sources:<a class="headerlink" href="#sources" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.djangoproject.com/en/3.0/howto/deployment/">https://docs.djangoproject.com/en/3.0/howto/deployment/</a></p></li>
<li><p><a class="reference external" href="https://wiki.ubuntuusers.de/Apache_2.4/">https://wiki.ubuntuusers.de/Apache_2.4/</a></p></li>
<li><p><a class="reference external" href="https://www.digitalocean.com/community/tutorials/how-to-serve-django-applications-with-apache-and-mod_wsgi-on-ubuntu-16-04">https://www.digitalocean.com/community/tutorials/how-to-serve-django-applications-with-apache-and-mod_wsgi-on-ubuntu-16-04</a></p></li>
</ul>
</div>
<div class="section" id="requirements">
<h3>Requirements:<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>a web server</p></li>
<li><p>basic knowledge of bash</p></li>
<li><p>Python 3</p></li>
</ul>
</div>
<div class="section" id="basic-configuration">
<h3>Basic configuration:<a class="headerlink" href="#basic-configuration" title="Permalink to this headline">¶</a></h3>
<p>Update your distro</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">apt</span> <span class="pre">update</span> <span class="pre">&amp;&amp;</span> <span class="pre">sudo</span> <span class="pre">apt</span> <span class="pre">upgrade</span></code></p>
</div></blockquote>
<p>Install Dependencies for the deployment. (We use Python3)</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">apt-get</span> <span class="pre">install</span> <span class="pre">python3-pip</span> <span class="pre">apache2</span> <span class="pre">libapache2-mod-wsgi-py3</span></code></p>
</div></blockquote>
<p>You also need to install virtualenv, to seperate Python from your system’s python.
Important is that you use python 3 because we use the Apache mod_wsgi for
python 3.</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">pip3</span> <span class="pre">install</span> <span class="pre">virtualenv</span></code></p>
</div></blockquote>
<p>Now we need to clone the Git-Repository and setup the virtualenv for Python.
First you need to change to the directory that you want to clone this web application to.
Then:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">https://github.com/mribrgr/StuRa-Mitgliederdatenbank.git</span></code>
<code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">StuRa-Mitgliederdatenbank/</span></code></p>
</div></blockquote>
<p>Now create a virtual environment and activate it.</p>
<blockquote>
<div><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">virtualenv</span> <span class="pre">venv</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">source</span> <span class="pre">venv/bin/activate</span></code></div>
</div>
</div></blockquote>
<p>If you have successfully activated your virtual ennvironment than your prompt should
look something like this <code class="docutils literal notranslate"><span class="pre">(venv)</span> <span class="pre">user&#64;host:StuRa-Mitgliederdatenbank</span></code>. The last
step is to install the requirements.txt in the virtual environement.</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">-r</span> <span class="pre">requirements.txt</span></code></p>
</div></blockquote>
</div>
<div class="section" id="adjust-django-project-settings">
<h3>Adjust Django Project Settings:<a class="headerlink" href="#adjust-django-project-settings" title="Permalink to this headline">¶</a></h3>
<p>First we need to configure <code class="docutils literal notranslate"><span class="pre">StuRa-Mitgliederdatenbank/bin/settings.py</span></code>:
We open the file first (based on the previous chapter)</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">nano</span> <span class="pre">bin/settings.py</span></code></p>
</div></blockquote>
<p>For a productive enviroment set the debug output to false.</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">DEBUG</span> <span class="pre">=</span> <span class="pre">False</span></code></p>
</div></blockquote>
<p>Here we need to register our server’s public IP address or domain name.
Replace “IP_or_DOMAIN” with your personal IP address or domain name.</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">ALLOWED_HOSTS</span> <span class="pre">=</span> <span class="pre">[&quot;IP_or_DOMAIN&quot;]</span></code></p>
</div></blockquote>
<p>At the bottom of the settings.py we need to define a static directory for our static html files.</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">STATIC_ROOT</span> <span class="pre">=</span> <span class="pre">os.path.join(BASE_DIR,</span> <span class="pre">'mystatic/')</span></code></p>
</div></blockquote>
<p>Now we can close and save the file.
After this you need to create the folder static in the directory StuRa-Mitgliederdatenbank
with the command.</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">mkdir</span> <span class="pre">static</span></code></p>
</div></blockquote>
<p>The last step is to do initial commands:</p>
<blockquote>
<div><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">./manage.py</span> <span class="pre">makemigrations</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">./manage.py</span> <span class="pre">migrate</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">./manage.py</span> <span class="pre">collectstatic</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">./manage.py</span> <span class="pre">createsuperuser</span></code></div>
</div>
</div></blockquote>
<p>An optional step that can be done is to fill in some functions that are common
to the StuRa of the HTW-Dresden.</p>
<blockquote>
<div><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">importscripts</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">main.py</span></code></div>
</div>
</div></blockquote>
<p>Now wait a little moment and then you can change to the parent directory.</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">..</span></code></p>
</div></blockquote>
<p>And deactivate the virtual environment:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">deactivate</span></code></p>
</div></blockquote>
</div>
<div class="section" id="configure-apache2">
<h3>Configure Apache2:<a class="headerlink" href="#configure-apache2" title="Permalink to this headline">¶</a></h3>
<p>To enable Apache2 as front end we need to configure WSGI pass.
To achieve this we need to edit the default virtual host file:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">nano</span> <span class="pre">/etc/apache2/sites-available/000-default.conf</span></code></p>
</div></blockquote>
<p>We can keep everything that is present in this file and add our config above
the last <code class="docutils literal notranslate"><span class="pre">&lt;/VirtualHost&gt;</span></code> tag. What we first specify is the static directory
and the path to the wsgi.py.
(In this Example I have cloned the directory in ~/StuRa-Mitgliederdatenbank)
(pi is my username change it to yours)</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">/etc/apache2/sites-available/000-default.conf</span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&lt;VirtualHost *:80&gt;

  . . .

  Alias /static /home/pi/StuRa-Mitgliederdatenbank/mystatic
  &lt;Directory /home/pi/StuRa-Mitgliederdatenbank/mystatic&gt;
      Require all granted
  &lt;/Directory&gt;

  &lt;Directory /home/pi/StuRa-Mitgliederdatenbank/bin&gt;
    &lt;Files wsgi.py&gt;
      Require all granted
    &lt;/Files&gt;
  &lt;/Directory&gt;

&lt;/VirtualHost&gt;
</pre></div>
</div>
</div>
<p>Now we add the recommended deamon mode to the WSGI process.
To do it you need to append the following lines to the Apache config.</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">/etc/apache2/sites-available/000-default.conf</span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&lt;VirtualHost *:80&gt;

  . . .

  WSGIDaemonProcess StuRa-Mitgliederdatenbank python-home<span class="o">=</span>/home/pi/StuRa-Mitgliederdatenbank/venv python-path<span class="o">=</span>/home/pi/StuRa-Mitgliederdatenbank
  WSGIProcessGroup StuRa-Mitgliederdatenbank
  WSGIScriptAlias / /home/pi/StuRa-Mitgliederdatenbank/bin/wsgi.py

&lt;/VirtualHost&gt;
</pre></div>
</div>
</div>
</div>
<div class="section" id="solve-some-permission-issues">
<h3>Solve some Permission Issues:<a class="headerlink" href="#solve-some-permission-issues" title="Permalink to this headline">¶</a></h3>
<p>The first step is to change the permissions of the database, so that group owner
can read and write. Then we need to transfer the ownership of some files to Apache2
group and user <code class="docutils literal notranslate"><span class="pre">www-data</span></code>.</p>
<blockquote>
<div><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">chmod</span> <span class="pre">664</span> <span class="pre">~/StuRa-Mitgliederdatenbank/db.sqlite3</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">chown</span> <span class="pre">www-data:www-data</span> <span class="pre">~/StuRa-Mitgliederdatenbank/db.sqlite3</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">chown</span> <span class="pre">www-data:www-data</span> <span class="pre">~/StuRa-Mitgliederdatenbank</span></code></div>
</div>
</div></blockquote>
<p>If you got firewall issues, allow Apache to acces the firewall example:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">ufw</span> <span class="pre">allow</span> <span class="pre">'Apache</span> <span class="pre">Full'</span></code></p>
</div></blockquote>
<p>Last but not least check the Apache files if everything is correct:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">apache2ctl</span> <span class="pre">configtest</span></code></p>
</div></blockquote>
<p>If the output looks like <code class="docutils literal notranslate"><span class="pre">Syntax</span> <span class="pre">OK</span></code> you are done and can restart your apache2
service:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">systemctl</span> <span class="pre">restart</span> <span class="pre">apache2</span></code></p>
</div></blockquote>
</div>
</div>
<div class="section" id="cronjobs">
<h2>Cronjobs<a class="headerlink" href="#cronjobs" title="Permalink to this headline">¶</a></h2>
<p>In the following lines there is an explanation how to create cronjobs to
schedule tasks. These tasks help to cleanup the database of the application.</p>
<p>First make sure you have installed cron than you can add cronjobs
with the command:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">crontab</span> <span class="pre">-e</span></code></p>
</div></blockquote>
<p>Now you can see a file like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Edit this file to introduce tasks to be run by cron.</span>
<span class="c1">#</span>
<span class="c1"># Each task to run has to be defined through a single line</span>
<span class="c1"># indicating with different fields when the task will be run</span>
<span class="c1"># and what command to run for the task</span>
<span class="c1">#</span>
<span class="c1"># To define the time you can provide concrete values for</span>
<span class="c1"># minute (m), hour (h), day of month (dom), month (mon),</span>
<span class="c1"># and day of week (dow) or use &#39;*&#39; in these fields (for &#39;any&#39;).</span>
<span class="c1">#</span>
<span class="c1"># Notice that tasks will be started based on the cron&#39;s system</span>
<span class="c1"># daemon&#39;s notion of time and timezones.</span>
<span class="c1">#</span>
<span class="c1"># Output of the crontab jobs (including errors) is sent through</span>
<span class="c1"># email to the user the crontab file belongs to (unless redirected).</span>
<span class="c1">#</span>
<span class="c1"># For example, you can run a backup of all your user accounts</span>
<span class="c1"># at 5 a.m every week with:</span>
<span class="c1"># 0 5 * * 1 tar -zcf /var/backups/home.tgz /home/</span>
<span class="c1">#</span>
<span class="c1"># For more information see the manual pages of crontab(5) and cron(8)</span>
<span class="c1">#</span>
<span class="c1"># m h  dom mon dow   command</span>
</pre></div>
</div>
<p>At the bottom of the file you can add your personal cronjobs.
To keep it simple our recommendation is to create a script with all commands you
want (described in the commands section of the code documentation).
You can easily schedule this script to run once a week with cronjob.</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">0</span> <span class="pre">0</span> <span class="pre">*</span> <span class="pre">*</span> <span class="pre">0</span> <span class="pre">bash</span> <span class="pre">/path/to/script</span></code></p>
</div></blockquote>
</div>
<div class="section" id="update-the-application">
<h2>Update the Application<a class="headerlink" href="#update-the-application" title="Permalink to this headline">¶</a></h2>
<p>This section describes how to update the application from an existing deployment.</p>
<div class="section" id="update-from-github-with-no-changes-in-migrations">
<h3>Update From GitHub with no changes in migrations:<a class="headerlink" href="#update-from-github-with-no-changes-in-migrations" title="Permalink to this headline">¶</a></h3>
<p>First you need to get the ownership back from www-data.
In my example my user is <em>pi</em> and the application is locatetd
in pi’s home directory.</p>
<blockquote>
<div><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">chown</span> <span class="pre">pi:pi</span> <span class="pre">~/StuRa-Mitgliederdatenbank/db.sqlite3</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">chown</span> <span class="pre">pi:pi</span> <span class="pre">~/StuRa-Mitgliederdatenbank</span></code></div>
</div>
</div></blockquote>
<p>Now we need to stash our changes we have done during our config.</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">stash</span></code></p>
</div></blockquote>
<p>We can now pull the latest version from the git Repository</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">pull</span></code></p>
</div></blockquote>
<p>To apply our configs back we need to get them back from the stash</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">stash</span> <span class="pre">pop</span></code></p>
</div></blockquote>
<dl>
<dt>At last you need to give the ownership back to www-data.</dt><dd><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">chown</span> <span class="pre">www-data:www-data</span> <span class="pre">~/StuRa-Mitgliederdatenbank/db.sqlite3</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">chown</span> <span class="pre">www-data:www-data</span> <span class="pre">~/StuRa-Mitgliederdatenbank</span></code></div>
</div>
</dd>
</dl>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="masterDeveloperDoc.html" class="btn btn-neutral float-right" title="Developer Documentation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="masterUserDoc.html" class="btn btn-neutral float-left" title="User Documentation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Team T8

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>